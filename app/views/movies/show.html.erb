<div class='row mt-3 border'>
  <div class='col-12 pt-3'>
    <div class='row dark_row'>
      <div class='col-lg-3 col-md-3'>
        <%= image_tag url_for(@movie.thumbnail), class: 'img-fluid movie_thumbnail' %>
      </div>

      <div class='col-lg-6 col-md-6'>
        <h2><%= raw "#{@movie.title} (#{@movie.release_date.year})"%></h2>
        <h5><%= @movie.genre %></h5>
        <h6><span class="fa fa-star golden-star pr-2"></span><%= @movie.rating.round(1) %> / 5.0</h6>
        <h5 class='mt-5 movie-description'><%= raw @movie.description %></h5>

        <% if user_signed_in? && allow_posting_review(current_user, @movie) %>
          <h2 class='pt-5 review-form-row adding'>Add Review</h2>
          <%= render partial: 'reviews/review_form', locals: { request_method: :post, button_text: 'Post Review', remote: true, object: @review, form_class: 'adding', path: movie_reviews_path(@movie.id) } %>
        <% end %>

      </div>

      <div class='col-lg-3 col-md-3'>
        <% if user_signed_in? && current_user.admin? %>
        <%= link_to 'Edit', edit_movie_path(@movie), class: 'btn btn-primary float-right ml-2' %>
        <%= link_to 'Delete', movie_path(@movie), method: :delete, data: { confirm: 'Are you sure you want to this movie?' }, class: 'btn btn-primary float-right' %>
        <% end %>

        <% if user_signed_in? %>
          <% if favourite_movie?(@movie) %>
            <h3 class='favourite-h'><%= link_to fa_icon('star ', class: 'pull-right favourite-star golden-star pr-2 pt-1 border-1'), remove_favourite_path(current_user.id, @movie), remote: true %></h3>
          <% else %>
            <h3 class='favourite-h'><%= link_to fa_icon('star ', class: 'pull-right favourite-star pr-2 pt-1 border-1'), add_favourite_path(current_user.id, @movie), remote: true %></h3>
          <% end %>
        <% end %>

      </div>
    </div>

    <ul class="nav nav-tabs pt-3 border-0 ml-4" id="myTab" role="tablist">
      <li class="nav-item border-0">
        <a class="nav-link active" id="review-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="review" aria-selected="false"><h5>Reviews</h5></a>
      </li>
      <li class="nav-item border-0">
        <a class="nav-link" id="cast-tab" data-toggle="tab" href="#cast" role="tab" aria-controls="cast" aria-selected="true"><h5>Movie Cast</h5></a>
      </li>
      <li class="nav-item border-0">
        <a class="nav-link" id="photo-tab" data-toggle="tab" href="#photos" role="tab" aria-controls="photo" aria-selected="false"><h5>Photo Gallery</h5></a>
      </li>
    </ul>

    <div class="tab-content" id="myTabContent">

      <div class="tab-pane fade" id="cast" role="tabpanel" aria-labelledby="cast-tab">
        <%= render 'cast' %>
      </div>

      <div class="tab-pane fade" id="photos" role="tabpanel" aria-labelledby="photo-tab">
        <%= render 'movie_gallery' %>
      </div>

      <div class="tab-pane fade show active" id="reviews" role="tabpanel" aria-labelledby="review-tab">
        <div class='row'>
          <div class='reviews col-lg-12'>
            <% @reviews.each do |single_review| %>
              <%= render partial: 'review', locals: { review: single_review, reported_reviews_by_user: @reviews_reported_by_user } %>
            <% end %>
            <%= paginate @reviews %>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>


<!-- Bootstrap modal to edit a review posted by the user-->
<div class="modal fade" id="editReview" tabindex="-1" role="dialog" aria-labelledby="editReviewlabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Review</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class='modal-body'>
        <%= render partial: 'reviews/review_form', locals: { request_method: :patch, button_text: 'Update Review', remote: false, object: @review, form_class: 'editing', path: movie_review_path(@movie.id,-1) } %>
      </div>
    </div>
  </div>
</div>

